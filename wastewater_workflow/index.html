<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><link rel="canonical" href="https://CDPHE-bioinformatics.github.io/CDPHE-SARS-CoV-2/wastewater_workflow/" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>Wastewater Workflow - CDPHE-SARS-CoV-2</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Wastewater Workflow";
        var mkdocs_page_input_path = "wastewater_workflow.md";
        var mkdocs_page_url = "/CDPHE-SARS-CoV-2/wastewater_workflow/";
      </script>
    
    <script src="../js/jquery-3.6.0.min.js" defer></script>
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
      <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> CDPHE-SARS-CoV-2
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="..">Home</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../setup/">Setup</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../indel_finder/">Indel Finder</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../python_scripts/">Python Scripts</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../assembly_workflow/">Assembly Workflows</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../transfer_workflow/">Transfer Workflows</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../results_workflow/">Results Workflows</a>
                </li>
              </ul>
              <ul class="current">
                <li class="toctree-l1 current"><a class="reference internal current" href="./">Wastewater Workflow</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#inputs">Inputs</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#outputs">Outputs</a>
    </li>
    </ul>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../nextstrain_workflow/">Nextstrain Workflow</a>
                </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">CDPHE-SARS-CoV-2</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" aria-label="Docs"></a> &raquo;</li>
      <li>Wastewater Workflow</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="wastewater-workflow">Wastewater Workflow</h1>
<p><strong>This workflow is undergoing updates.</strong></p>
<p>For wastewater samples, use one of the assembly workflows above to generate coordinate sorted and primer trimmed bam files. Then see below for how we use <a href="https://github.com/andersen-lab/Freyja">freyja</a> for performing variant calling, lineage demixing to generate summary files for wastewater whole genome sequencing of SARS-CoV-2, as well as custom code to summarize VOC-associated constellations of mutations.</p>
<p>The workflow accepts "sample_set" as the root entity type and uses the data table from any of the three assembly workflows. All three assembly workflows (illumina pe, illumina se and ont) are compatible with this workflow.</p>
<p>Briefly the workflow performs the following:</p>
<ol>
<li>Add read groups to the bam files using samtools</li>
<li>Use Freya variants to perform variant calling using freya and generate a depths filter_reads</li>
<li>Run Freya demix to perform lineage deconvolution and to estimate lineage abundances</li>
<li>Pull out a set of curated VOC-associated mutations from the variants file generated by Freya</li>
<li>Generate a summary of constellations of VOC-associated mutations</li>
<li>transfer the outputs to a user-defined google bucket</li>
</ol>
<p><img alt="SC2_wastewater_variant_calling.wdl workflow diagram" src="../img/SC2_wastewater_variant_calling.png" /></p>
<h2 id="inputs">Inputs</h2>
<p>Below is a summary of the workflow input variables along with the syntax used for the attribute column when setting up the workflow to run on Terra.bio. For the attributes, the ""this.sample{terra_datatable_name}s." syntax refers Terra to pull the variable from the terra datatable as used for sample sets. These variables were either in the original terra datatable as inputs for the assembly workflow (see referece based assembly workflow inputs sections above for more details) or added as outputs during the assemlby workflow (see reference based assembly workflow outputs sections for more details). The  "workspace." syntax refers Terra to pull the variable from the terra workspace data. Workspace data is describe in the <code>Getting Started</code> drop down menu above.</p>
<table>
<thead>
<tr>
<th>workflow variable</th>
<th>attribute (input syntax into workflow)</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>covid_genome</code></td>
<td>workspace.covid_genome</td>
</tr>
<tr>
<td><code>out_dir</code></td>
<td>'gs://covid_terra/{seq_run}/terra_outputs' (must be written as a string in quotes-- we have not updated the workflow to accept the out_dir column from the terra datatable)</td>
</tr>
<tr>
<td><code>sample_id</code></td>
<td>this.sample{terra_datatable_name}s.sample{terra_datatable_name}_id</td>
</tr>
<tr>
<td><code>trimsort_bam</code></td>
<td>this.sample{terra_datatable_name}s.trimsort_bam</td>
</tr>
<tr>
<td><code>voc_annotations</code></td>
<td>workspace.voc_annotations</td>
</tr>
<tr>
<td><code>voc_bed</code></td>
<td>workspace.voc_bed</td>
</tr>
</tbody>
</table>
<h2 id="outputs">Outputs</h2>
<p>This workflow generates several output files which are transfered to the user defined google bucket as defined by a string (e.g. "gs://covid_terra/NEXSEQ_101/terra_outputs"). The table below details each output. For more details regarding the values in each column for the outputs see either the software readmes or the readme for the specific python script as listed in the description.</p>
<table>
<thead>
<tr>
<th>output variable name</th>
<th>file_name</th>
<th>description</th>
<th>google bucket path</th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td><code>addrg_bam</code></td>
<td><code>{sample_name}_addRG.bam</code></td>
<td>???</td>
<td>N/A</td>
<td></td>
</tr>
<tr>
<td><code>variants</code></td>
<td><code>{smaple_name}_variants.tsv</code></td>
<td>generated for each sample; output from freyja demix</td>
<td><code>gs://{user_defined_gcp_bucket}/waste_water_variant_calling/freyja/</code></td>
<td></td>
</tr>
<tr>
<td><code>depth</code></td>
<td><code>{sample_name}_depth.tsv</code></td>
<td>generated for each sample; output from freyja variants</td>
<td><code>gs://{user_defined_gcp_bucket}/waste_water_variant_calling/freyja/</code></td>
<td></td>
</tr>
<tr>
<td><code>demix</code></td>
<td><code>{sample_name}_demixed.tsv</code></td>
<td>generated for each sample; output from freyja demix</td>
<td><code>gs://{user_defined_gcp_bucket}/waste_water_variant_calling/freyja/</code></td>
<td></td>
</tr>
<tr>
<td><code>fill_NA_tsv</code></td>
<td><code>{sample_name}_voc_fill_NA.tsv</code></td>
<td></td>
<td>N/A</td>
<td></td>
</tr>
<tr>
<td><code>reformatted_tsv</code></td>
<td><code>{sample_name}_voc_reformat.tsv</code></td>
<td>generated for each sample</td>
<td>N/A</td>
<td></td>
</tr>
<tr>
<td><code>sample_voc_tsv_summary</code></td>
<td><code>{sample_name}_voc_mutations_forsummary.tsv</code></td>
<td>generated for each sample</td>
<td><code>gs://{user_defined_gcp_bucket}/waste_water_variant_calling/sample_variants/</code></td>
<td></td>
</tr>
<tr>
<td><code>sample_voc_tsv_counts</code></td>
<td><code>{sample_name}_voc_mutations_counts.tsv</code></td>
<td>generated for each sample</td>
<td><code>gs://{user_defined_gcp_bucket}/waste_water_variant_calling/sample_variants/</code></td>
<td></td>
</tr>
<tr>
<td><code>demix_reformatted</code></td>
<td><code>{sample_id}_demixed_reformatted.tsv</code></td>
<td>generated for each sample</td>
<td>N/A</td>
<td></td>
</tr>
<tr>
<td><code>voc_summary_temp</code></td>
<td><code>voc_mutations_summary_temp.tsv</code></td>
<td></td>
<td>N/A</td>
<td></td>
</tr>
<tr>
<td><code>voc_counts</code></td>
<td><code>voc_mutations_counts.tsv</code></td>
<td></td>
<td><code>gs://{user_defined_gcp_bucket}/waste_water_variant_calling/</code></td>
<td></td>
</tr>
<tr>
<td><code>voc_summary</code></td>
<td><code>voc_mutations_summary.tsv</code></td>
<td></td>
<td><code>gs://{user_defined_gcp_bucket}/waste_water_variant_calling/</code></td>
<td></td>
</tr>
<tr>
<td><code>demix_summary</code></td>
<td><code>lineage_abundances.tsv</code></td>
<td></td>
<td><code>gs://{user_defined_gcp_bucket}/waste_water_variant_calling/</code></td>
<td></td>
</tr>
<tr>
<td><code>transfer_date</code></td>
<td>N/A</td>
<td>date the workflow was run</td>
<td>N/A</td>
<td></td>
</tr>
</tbody>
</table>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../results_workflow/" class="btn btn-neutral float-left" title="Results Workflows"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../nextstrain_workflow/" class="btn btn-neutral float-right" title="Nextstrain Workflow">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../results_workflow/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../nextstrain_workflow/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme_extra.js" defer></script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
